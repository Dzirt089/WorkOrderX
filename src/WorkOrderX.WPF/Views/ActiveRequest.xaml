<Page x:Class="WorkOrderX.WPF.Views.ActiveRequest"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
	  xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
	  xmlns:local="clr-namespace:WorkOrderX.WPF.Views"
	  mc:Ignorable="d" 
	  xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
	  xmlns:slv="clr-namespace:WorkOrderX.WPF.Utils" 
	  xmlns:sys="clr-namespace:System;assembly=mscorlib"
	  xmlns:conv="clr-namespace:WorkOrderX.WPF.Converters"
	  d:DesignHeight="700" d:DesignWidth="1000"
	  Title="ActiveRequest">
	<Page.Resources >
		<conv:DateBeforeTodayConverter x:Key="DateBeforeTodayConverter"/>
		<conv:DateIsTodayConverter x:Key="DateIsTodayConverter"/>
	</Page.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		
		
		<StackPanel Grid.Row="0" Orientation="Horizontal" 
						Visibility="{Binding VisibilitySelectRequest, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
						HorizontalAlignment="Center" VerticalAlignment="Center" >
			<!-- Ремонт инструмента -->
			<RadioButton 
					x:Name="Repair"
					Content="Ремонт инструмента" 
					FontSize="16"
					Width="200"
					Height="20"
					VerticalContentAlignment="Center"
					Margin="5"
					Background="#3498db"
					IsChecked ="{Binding IsSelectRepair, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
					Command="{Binding FilterForActiveCommand}"/>

			<!-- Хозяйственные работы -->
			<RadioButton
					x:Name="Chore"
					Content="Хоз. работы" 
					FontSize="16"
					Width="200"
					Height="20"
					VerticalContentAlignment="Center"
					Margin="5"
					Background="#e67e22"
					IsChecked ="{Binding IsSelectChore, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
					Command="{Binding FilterForActiveCommand}"/>
		</StackPanel>


		<Border BorderThickness="2" Grid.Row="1" CornerRadius="8" BorderBrush="DodgerBlue" Margin="10">

			<slv:SortableListView Grid.Row="1"
				ItemsSource="{Binding ActiveRequests, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
				SelectedItem="{Binding SelectedRequest, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
				FontSize="14" BorderThickness="0">
				<slv:SortableListView.ItemContainerStyle>
					<Style TargetType="ListViewItem">
						<Setter Property="Margin" Value="0,0,0,5" />
						<Setter Property="Padding" Value="5" />
						<Setter Property="BorderThickness" Value="1" />
						<Setter Property="BorderBrush" Value="LightBlue" />
						<Setter Property="Background" Value="Transparent" />
						<Setter Property="HorizontalContentAlignment" Value="Stretch" />

						<Style.Triggers>
							<!-- Hover -->
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Background" Value="DodgerBlue" />
								<Setter Property="Foreground" Value="Black" />
							</Trigger>

							<!-- Selected -->
							<Trigger Property="IsSelected" Value="True">
								<Setter Property="Background" Value="LightGreen"/>
							</Trigger>

							<!-- План < сегодня — КРАСНЫЙ -->
							<DataTrigger Binding="{Binding PlannedAt}" Value="{x:Static sys:DateTime.MinValue}">
								<!--пока ничего не делаем, если не не придумаю - удалить. sys:DateTime.MinValue = 0001-01-01 -->
							</DataTrigger>

							<DataTrigger Binding="{Binding PlannedAt, Converter={StaticResource DateBeforeTodayConverter}}" Value="True">
								<Setter Property="Background" Value="IndianRed" />
							</DataTrigger>

							<!-- План == сегодня — ЖЁЛТЫЙ -->
							<DataTrigger Binding="{Binding PlannedAt, Converter={StaticResource DateIsTodayConverter}}" Value="True">
								<Setter Property="Background" Value="LightGoldenrodYellow" />
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</slv:SortableListView.ItemContainerStyle>
				<slv:SortableListView.Resources>
					<Style TargetType="GridViewColumnHeader">
						<Setter Property="HorizontalContentAlignment" Value="Center" />
						<Setter Property="FontWeight" Value="Bold" />
						<Setter Property="Padding" Value="5" />

						<Setter Property="BorderThickness" Value="1" />
						<Setter Property="BorderBrush" Value="DodgerBlue" />
					</Style>
					<Style TargetType="TextBlock">
						<Setter Property="VerticalAlignment" Value="Center" />
						<Setter Property="TextWrapping" Value="Wrap" />
						<Setter Property="Margin" Value="5,0" />
					</Style>
				</slv:SortableListView.Resources>
				<i:Interaction.Triggers>
					<i:EventTrigger EventName="MouseDoubleClick">
						<i:InvokeCommandAction Command="{Binding ShowSelectRequestRepairCommand}" CommandParameter="{Binding SelectedRequest.Id}"/>
					</i:EventTrigger>
				</i:Interaction.Triggers>
				<slv:SortableListView.View>
					<GridView>
						<GridViewColumn Header="Заявка №" 
										DisplayMemberBinding="{Binding Path=ApplicationNumber}"  Width="80"
										slv:SortableListView.SortPropertyName="ApplicationNumber"/>
						<GridViewColumn Header="Статус" 
										DisplayMemberBinding="{Binding Path=ApplicationStatus}" Width="130"
										slv:SortableListView.SortPropertyName="ApplicationStatus"/>
						<GridViewColumn Header="Дата" 
										DisplayMemberBinding="{Binding Path=CreatedAt, StringFormat={}{0:dd.MM.yyyy HH:mm}}" Width="120"
										slv:SortableListView.SortPropertyName="CreatedAt"/>
						<GridViewColumn Header="Последнее изменение" 
										DisplayMemberBinding="{Binding Path=UpdatedAt, StringFormat={}{0:dd.MM.yyyy HH:mm:ss}}" Width="170"
										slv:SortableListView.SortPropertyName="UpdatedAt"/>
						<GridViewColumn Header="План" 
										DisplayMemberBinding="{Binding Path=PlannedAt, StringFormat={}{0:dd.MM.yyyy HH:mm}}" Width="120"
										slv:SortableListView.SortPropertyName="PlannedAt"/>
						<GridViewColumn Header="Заказчик" 
										DisplayMemberBinding="{Binding Path=CustomerEmployee.Name}" Width="140"
										slv:SortableListView.SortPropertyName="CustomerEmployee.Name"/>
						<GridViewColumn Header="Исполнитель" 
										DisplayMemberBinding="{Binding Path=ExecutorEmployee.Name}" Width="140"
										slv:SortableListView.SortPropertyName="ExecutorEmployee.Name"/>
						<GridViewColumn Header="Важность" 
										DisplayMemberBinding="{Binding Path=Importance}" Width="90"
										slv:SortableListView.SortPropertyName="Importance"/>
					</GridView>
				</slv:SortableListView.View>
			</slv:SortableListView>
		</Border>
	</Grid>
	
</Page>
